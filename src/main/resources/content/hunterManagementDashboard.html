<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hunting Board Admin</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="container">
    <div class="header">
    <h1>Hunter and Area Management Dashboard</h1>
    </div>
    <div class="tabs">
        <div class="tab active" data-tab="areas">Areas</div>
        <div class="tab" data-tab="hunters">Hunters</div>
        <div class="tab" data-tab="blinds">Blinds</div>
    </div>

    <div class="content">
        <!-- Areas Tab Content -->
        <div class="tab-content active" id="areas-content">
            <button class="add-btn" id="add-area-btn">Add New Area</button>
            <!-- Area Form -->
            <div class="form-container" id="area-form">
                <h2 id="area-form-title">Add New Area</h2>
                <form id="area-form-element">
                    <input type="hidden" id="area-id">
                    <div class="form-group">
                        <label for="area-name">Name:</label>
                        <input type="text" id="area-name" required>
                    </div>
                    <div class="form-group">
                        <label for="area-description">Description:</label>
                        <textarea id="area-description" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="area-manager">Manager (Optional):</label>
                        <input type="text" id="area-manager">
                    </div>
                    <div class="form-buttons">
                        <button type="submit" class="submit-btn">Save</button>
                        <button type="button" class="cancel-btn" id="cancel-area-form">Cancel</button>
                    </div>
                </form>
            </div>
            <div class="loader" id="areas-loader">Loading areas...</div>
            <div class="error-message" id="areas-error"></div>
            <table id="areas-table">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Manager</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody id="areas-list">
                <!-- Areas will be added here dynamically -->
                </tbody>
            </table>

        </div>

        <!-- Hunters Tab Content -->
        <div class="tab-content" id="hunters-content">
            <button class="add-btn" id="add-hunter-btn">Add New Hunter</button>
            <!-- Hunter Form -->
            <div class="form-container" id="hunter-form">
                <h2 id="hunter-form-title">Add New Hunter</h2>
                <form id="hunter-form-element">
                    <input type="hidden" id="hunter-id">
                    <div class="form-group">
                        <label for="hunter-name">Name:</label>
                        <input type="text" id="hunter-name" required>
                    </div>
                    <div class="form-group">
                        <label for="hunter-area">Assigned Area:</label>
                        <select id="hunter-area" required>
                            <option value="">Select an area</option>
                            <!-- Areas will be loaded dynamically -->
                        </select>
                    </div>
                    <div class="form-buttons">
                        <button type="submit" class="submit-btn">Save</button>
                        <button type="button" class="cancel-btn" id="cancel-hunter-form">Cancel</button>
                    </div>
                </form>
            </div>
            <div class="loader" id="hunters-loader">Loading hunters...</div>
            <div class="error-message" id="hunters-error"></div>
            <table id="hunters-table">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Assigned Area</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody id="hunters-list">
                <!-- Hunters will be added here dynamically -->
                </tbody>
            </table>
        </div>

        <!-- Blinds Tab Content -->
        <div class="tab-content" id="blinds-content">
            <button class="add-btn" id="add-blind-btn">Add New Blind</button>
            <!-- Blind Form -->
            <div class="form-container" id="blind-form">
                <h2 id="blind-form-title">Add New Blind</h2>
                <form id="blind-form-element">
                    <input type="hidden" id="blind-id">
                    <div class="form-group">
                        <label for="blind-description">Description:</label>
                        <textarea id="blind-description" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="blind-type">Type:</label>
                        <select id="blind-type" required>
                            <option value="">Select a type</option>
                            <option value="Tower">Tower</option>
                            <option value="Ground">Ground</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="blind-area">Assigned Area:</label>
                        <select id="blind-area">
                            <option value="">Select an area</option>
                            <!-- Areas will be loaded dynamically -->
                        </select>
                    </div>
                    <div class="form-buttons">
                        <button type="submit" class="submit-btn">Save</button>
                        <button type="button" class="cancel-btn" id="cancel-blind-form">Cancel</button>
                    </div>
                </form>
            </div>
            <div class="loader" id="blinds-loader">Loading blinds...</div>
            <div class="error-message" id="blinds-error"></div>
            <table id="blinds-table">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Description</th>
                    <th>Type</th>
                    <th>Area</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody id="blinds-list">
                <!-- Blinds will be added here dynamically -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<script src="config.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const BASE_URL = CONFIG.BASE_URL;

        // Cache DOM elements
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');

        // Areas elements
        const areasList = document.getElementById('areas-list');
        const areasLoader = document.getElementById('areas-loader');
        const areasError = document.getElementById('areas-error');
        const addAreaBtn = document.getElementById('add-area-btn');
        const areaForm = document.getElementById('area-form');
        const areaFormElement = document.getElementById('area-form-element');
        const areaFormTitle = document.getElementById('area-form-title');
        const cancelAreaForm = document.getElementById('cancel-area-form');

        // Hunters elements
        const huntersList = document.getElementById('hunters-list');
        const huntersLoader = document.getElementById('hunters-loader');
        const huntersError = document.getElementById('hunters-error');
        const addHunterBtn = document.getElementById('add-hunter-btn');
        const hunterForm = document.getElementById('hunter-form');
        const hunterFormElement = document.getElementById('hunter-form-element');
        const hunterFormTitle = document.getElementById('hunter-form-title');
        const cancelHunterForm = document.getElementById('cancel-hunter-form');
        const hunterArea = document.getElementById('hunter-area');

        // Blinds elements
        const blindsList = document.getElementById('blinds-list');
        const blindsLoader = document.getElementById('blinds-loader');
        const blindsError = document.getElementById('blinds-error');
        const addBlindBtn = document.getElementById('add-blind-btn');
        const blindForm = document.getElementById('blind-form');
        const blindFormElement = document.getElementById('blind-form-element');
        const blindFormTitle = document.getElementById('blind-form-title');
        const cancelBlindForm = document.getElementById('cancel-blind-form');

        // Store current data
        let areas = [];
        let hunters = [];
        let blinds = [];
        let currentAreaId = null;
        let currentHunterId = null;
        let currentBlindId = null;

        // Tab switching
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove active class from all tabs and contents
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));

                // Add active class to clicked tab and corresponding content
                tab.classList.add('active');
                const tabName = tab.getAttribute('data-tab');
                document.getElementById(`${tabName}-content`).classList.add('active');

                // Load data for the tab if it's not already loaded
                if (tabName === 'areas' && areas.length === 0) {
                    loadAreas();
                } else if (tabName === 'hunters' && hunters.length === 0) {
                    loadHunters();
                } else if (tabName === 'blinds' && blinds.length === 0) {
                    loadBlinds();
                }
            });
        });

        // Initial data load
        loadAreas();

        // Areas CRUD operations
        function loadAreas() {
            showLoader(areasLoader);
            hideError(areasError);

            fetch(`${BASE_URL}/area`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to load areas');
                    }
                    return response.json();
                })
                .then(data => {
                    areas = data;
                    renderAreas();
                    hideLoader(areasLoader);
                })
                .catch(error => {
                    showError(areasError, error.message);
                    hideLoader(areasLoader);
                });
        }

        function renderAreas() {
            areasList.innerHTML = '';

            if (areas.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="5" style="text-align: center;">No areas found</td>';
                areasList.appendChild(row);
                return;
            }

            areas.forEach(area => {
                const row = document.createElement('tr');
                row.innerHTML = `
                        <td>${area.id}</td>
                        <td>${area.name}</td>
                        <td>${area.description}</td>
                        <td>${area.manager || 'N/A'}</td>
                        <td>
                            <button class="action-btn edit-btn" data-id="${area.id}">Edit</button>
                            <button class="action-btn delete-btn" data-id="${area.id}">Delete</button>
                        </td>
                    `;

                // Add event listeners
                const editBtn = row.querySelector('.edit-btn');
                const deleteBtn = row.querySelector('.delete-btn');

                editBtn.addEventListener('click', () => editArea(area.id));
                deleteBtn.addEventListener('click', () => deleteArea(area.id));

                areasList.appendChild(row);
            });

            // Also update hunter form options
            updateHunterAreaOptions();
        }

        function editArea(id) {
            const area = areas.find(a => a.id === id);
            if (!area) return;

            currentAreaId = id;
            document.getElementById('area-id').value = area.id;
            document.getElementById('area-name').value = area.name;
            document.getElementById('area-description').value = area.description;
            document.getElementById('area-manager').value = area.manager || '';

            areaFormTitle.textContent = 'Edit Area';
            showForm(areaForm);
        }

        function deleteArea(id) {
            if (!confirm('Are you sure you want to delete this area?')) {
                return;
            }

            showLoader(areasLoader);
            hideError(areasError);

            fetch(`${BASE_URL}/area/${id}`, {
                method: 'DELETE'
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to delete area');
                    }
                    // Remove area from the list
                    areas = areas.filter(a => a.id !== id);
                    // Also remove associated hunters
                    hunters = hunters.filter(h => h.areaId !== id);
                    renderAreas();
                    hideLoader(areasLoader);
                })
                .catch(error => {
                    showError(areasError, error.message);
                    hideLoader(areasLoader);
                    renderAreas();
                });
        }

        addAreaBtn.addEventListener('click', () => {
            currentAreaId = null;
            areaFormElement.reset();
            areaFormTitle.textContent = 'Add New Area';
            showForm(areaForm);
        });

        cancelAreaForm.addEventListener('click', () => {
            hideForm(areaForm);
        });

        areaFormElement.addEventListener('submit', (e) => {
            e.preventDefault();

            const areaData = {
                name: document.getElementById('area-name').value,
                description: document.getElementById('area-description').value,
                manager: document.getElementById('area-manager').value || null
            };

            showLoader(areasLoader);
            hideError(areasError);

            if (currentAreaId) {
                // Update existing area
                areaData.id = currentAreaId;

                fetch(`${BASE_URL}/area/${currentAreaId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(areaData)
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to update area');
                        }
                        return response.json();
                    })
                    .then(updatedArea => {
                        // Update area in the list
                        const index = areas.findIndex(a => a.id === currentAreaId);
                        if (index !== -1) {
                            areas[index] = updatedArea;
                        }
                        renderAreas();
                        hideForm(areaForm);
                        hideLoader(areasLoader);
                    })
                    .catch(error => {
                        showError(areasError, error.message);
                        hideLoader(areasLoader);
                        renderAreas();
                        hideForm(areaForm);
                    });
            } else {
                // Add new area
                fetch(`${BASE_URL}/area`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(areaData)
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to add area');
                        }
                        return response.json();
                    })
                    .then(newArea => {
                        areas.push(newArea);
                        renderAreas();
                        hideForm(areaForm);
                        hideLoader(areasLoader);
                    })
                    .catch(error => {
                        showError(areasError, error.message);
                        hideLoader(areasLoader);
                        areas.push(areaData);
                        renderAreas();
                        hideForm(areaForm);
                    });
            }
        });

        // Hunters CRUD operations
        function loadHunters() {
            showLoader(huntersLoader);
            hideError(huntersError);
            fetch(`${BASE_URL}/hunters`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to load hunters');
                    }
                    return response.json();
                })
                .then(data => {
                    hunters = data;
                    renderHunters();
                    hideLoader(huntersLoader);
                })
                .catch(error => {
                    showError(huntersError, error.message);
                    hideLoader(huntersLoader);
                });
        }

        function updateHunterAreaOptions() {
            hunterArea.innerHTML = '<option value="">Select an area</option>';

            areas.forEach(area => {
                const option = document.createElement('option');
                option.value = area.id;
                option.textContent = area.name;
                hunterArea.appendChild(option);
            });
        }

        function renderHunters() {
            huntersList.innerHTML = '';

            if (hunters.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="4" style="text-align: center;">No hunters found</td>';
                huntersList.appendChild(row);
                return;
            }

            hunters.forEach(hunter => {
                const area = areas.find(a => a.id === hunter.areaId);
                const areaName = area ? area.name : 'Unknown Area';

                const row = document.createElement('tr');
                row.innerHTML = `
                        <td>${hunter.id}</td>
                        <td>${hunter.name}</td>
                        <td>${areaName}</td>
                        <td>
                            <button class="action-btn edit-btn" data-id="${hunter.id}">Edit</button>
                            <button class="action-btn delete-btn" data-id="${hunter.id}">Delete</button>
                        </td>
                    `;

                // Add event listeners
                const editBtn = row.querySelector('.edit-btn');
                const deleteBtn = row.querySelector('.delete-btn');

                editBtn.addEventListener('click', () => editHunter(hunter.id));
                deleteBtn.addEventListener('click', () => deleteHunter(hunter.id));

                huntersList.appendChild(row);
            });
        }

        function editHunter(id) {
            const hunter = hunters.find(h => h.id === id);
            if (!hunter) return;

            currentHunterId = id;
            document.getElementById('hunter-id').value = hunter.id;
            document.getElementById('hunter-name').value = hunter.name;
            document.getElementById('hunter-area').value = hunter.areaId;

            hunterFormTitle.textContent = 'Edit Hunter';
            showForm(hunterForm);
        }

        function deleteHunter(id) {
            if (!confirm('Are you sure you want to delete this hunter?')) {
                return;
            }

            showLoader(huntersLoader);
            hideError(huntersError);

            fetch(`${BASE_URL}/hunter/${id}`, {
                method: 'DELETE'
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to delete hunter');
                    }
                    // Remove hunter from the list
                    hunters = hunters.filter(h => h.id !== id);
                    renderHunters();
                    hideLoader(huntersLoader);
                })
                .catch(error => {
                    showError(huntersError, error.message);
                    hideLoader(huntersLoader);
                    renderHunters();
                });
        }

        addHunterBtn.addEventListener('click', () => {
            currentHunterId = null;
            hunterFormElement.reset();
            hunterFormTitle.textContent = 'Add New Hunter';
            showForm(hunterForm);
        });

        cancelHunterForm.addEventListener('click', () => {
            hideForm(hunterForm);
        });

        hunterFormElement.addEventListener('submit', (e) => {
            e.preventDefault();

            const hunterData = {
                name: document.getElementById('hunter-name').value,
                areaId: document.getElementById('hunter-area').value
            };

            showLoader(huntersLoader);
            hideError(huntersError);

            if (currentHunterId) {
                // Update existing hunter
                hunterData.id = currentHunterId;

                fetch(`${BASE_URL}/hunter/${currentHunterId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(hunterData)
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to update hunter');
                        }
                        return response.json();
                    })
                    .then(updatedHunter => {
                        // Update hunter in the list
                        const index = hunters.findIndex(h => h.id === currentHunterId);
                        if (index !== -1) {
                            hunters[index] = updatedHunter;
                        }
                        renderHunters();
                        hideForm(hunterForm);
                        hideLoader(huntersLoader);
                    })
                    .catch(error => {
                        showError(huntersError, error.message);
                        hideLoader(huntersLoader);
                        renderHunters();
                        hideForm(hunterForm);
                    });
            } else {
                // Add new hunter
                fetch(`${BASE_URL}/hunter`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(hunterData)
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to add hunter');
                        }
                        return response.json();
                    })
                    .then(newHunter => {
                        hunters.push(newHunter);
                        renderHunters();
                        hideForm(hunterForm);
                        hideLoader(huntersLoader);
                    })
                    .catch(error => {
                        showError(huntersError, error.message);
                        hideLoader(huntersLoader);
                        renderHunters();
                        hideForm(hunterForm);
                    });
            }
        });

        // Blinds CRUD operations
        function loadBlinds() {
            showLoader(blindsLoader);
            hideError(blindsError);

            fetch(`${BASE_URL}/blinds`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to load blinds');
                    }
                    return response.json();
                })
                .then(data => {
                    blinds = data;
                    renderBlinds();
                    hideLoader(blindsLoader);
                })
                .catch(error => {
                    showError(blindsError, error.message);
                    hideLoader(blindsLoader);
                });
        }

        function renderBlinds() {
            blindsList.innerHTML = '';


            if (blinds.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="5" style="text-align: center;">No blinds found</td>';
                blindsList.appendChild(row);
                return;
            }

            blinds.forEach(blind => {
                const row = document.createElement('tr');
                const area = areas.find(a => a.id === blind.areaId);
                const areaName = area ? area.name : 'Unknown Area';
                row.innerHTML = `
                        <td>${blind.id}</td>
                        <td>${blind.description}</td>
                        <td>${blind.type || 'N/A'}</td>
                        <td>${areaName}</td>
                        <td>
                            <button class="action-btn edit-btn" data-id="${blind.id}">Edit</button>
                            <button class="action-btn delete-btn" data-id="${blind.id}">Delete</button>
                        </td>
                    `;

                // Add event listeners
                const editBtn = row.querySelector('.edit-btn');
                const deleteBtn = row.querySelector('.delete-btn');

                editBtn.addEventListener('click', () => editBlind(blind.id));
                deleteBtn.addEventListener('click', () => deleteBlind(blind.id));

                blindsList.appendChild(row);
            });

            updateBlindsAreasOptions();
        }

        addBlindBtn.addEventListener('click', () => {
            currentBlindId = null;
            blindFormElement.reset();
            blindFormTitle.textContent = 'Add New Blind';
            showForm(blindForm);
        });

        cancelBlindForm.addEventListener('click', () => {
            hideForm(blindForm);
        });

        blindFormElement.addEventListener('submit', (e) => {
            e.preventDefault();
            const blindData = {
                description: document.getElementById('blind-description').value,
                type: document.getElementById('blind-type').value,
                areaId: document.getElementById('blind-area').value
            };
            showLoader(blindsLoader);
            hideError(blindsError);

            if (currentBlindId) {
                // Update existing blind
                blindData.id = currentBlindId;
                fetch(`${BASE_URL}/blind/${currentBlindId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(blindData)
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to update blind');
                        }
                        return response.json();
                    })
                    .then(updatedBlind => {
                        // Update blind in the list
                        const index = blinds.findIndex(b => b.id === currentBlindId);
                        if (index !== -1) {
                            blinds[index] = updatedBlind;
                        }
                        renderBlinds();
                        hideForm(blindForm);
                        hideLoader(blindsLoader);
                    })
                    .catch(error => {
                        showError(blindsError, error.message);
                        hideLoader(blindsLoader);
                        renderBlinds();
                        hideForm(blindForm);
                    });
            } else {
                // Add new blind
                fetch(`${BASE_URL}/blind`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(blindData)
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to add blind');
                        }
                        return response.json();
                    })
                    .then(newBlind => {
                        blinds.push(newBlind);
                        renderBlinds();
                        hideForm(blindForm);
                        hideLoader(blindsLoader);
                    })
                    .catch(error => {
                        showError(blindsError, error.message);
                        hideLoader(blindsLoader);
                        renderBlinds();
                        hideForm(blindForm);
                    });
            }
        });

        function editBlind(id) {
            const blind = blinds.find(b => b.id === id);
            if (!blind) return;

            currentBlindId = id;
            document.getElementById('blind-id').value = blind.id;
            document.getElementById('blind-description').value = blind.description;
            document.getElementById('blind-type').value = blind.type || '';
            document.getElementById('blind-area').value = blind.areaId || '';

            blindFormTitle.textContent = 'Edit Blind';
            showForm(blindForm);
        }

        function deleteBlind(id) {
            if (!confirm('Are you sure you want to delete this blind?')) {
                return;
            }

            showLoader(blindsLoader);
            hideError(blindsError);

            fetch(`${BASE_URL}/blind/${id}`, {
                method: 'DELETE'
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to delete blind');
                    }
                    // Remove blind from the list
                    blinds = blinds.filter(b => b.id !== id);
                    renderBlinds();
                    hideLoader(blindsLoader);
                })
                .catch(error => {
                    showError(blindsError, error.message);
                    hideLoader(blindsLoader);
                    renderBlinds();
                });
        }

        function updateBlindsAreasOptions() {
            const blindArea = document.getElementById('blind-area');
            blindArea.innerHTML = '<option value="">Select an area</option>';

            areas.forEach(area => {
                const option = document.createElement('option');
                option.value = area.id;
                option.textContent = area.name;
                blindArea.appendChild(option);
            });
        }

        function showLoader(loader) {
            loader.style.display = 'block';
        }

        function hideError(error) {
            error.style.display = 'none';
        }

        function showError(error, message) {
            error.textContent = message;
            error.style.display = 'block';
        }

        function hideLoader(loader) {
            loader.style.display = 'none';
        }

        function showForm(form) {
            form.style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function hideForm(form) {
            form.style.display = 'none';
        }
    });
</script>
</body>
</html>