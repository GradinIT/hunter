<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jakt Å Sånt</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="container">
    <div class="header">
    <h1>Jakt Å Sånt</h1>
    </div>
    <div class="tabs">
        <div class="tab active" data-tab="areas">Såt</div>
        <div class="tab" data-tab="hunters">Jägare</div>
        <div class="tab" data-tab="blinds">Pass</div>
        <div class="tab" data-tab="reports">Rapport Pass</div>
        <div class="tab" data-tab="observations">Observations</div>
        <div class="tab" data-tab="lottery">Lottning</div>
    </div>

    <div class="content">
        <!-- Areas Tab Content -->
        <div class="tab-content active" id="areas-content">
            <button class="add-btn" id="add-area-btn">Add New Area</button>
            <!-- Area Form -->
            <div class="form-container" id="area-form">
                <h2 id="area-form-title">Add New Area</h2>
                <form id="area-form-element">
                    <input type="hidden" id="area-id">
                    <div class="form-group">
                        <label for="area-name">Name:</label>
                        <input type="text" id="area-name" required>
                    </div>
                    <div class="form-group">
                        <label for="area-description">Description:</label>
                        <textarea id="area-description" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="area-manager">Manager (Optional):</label>
                        <input type="text" id="area-manager">
                    </div>
                    <div class="form-buttons">
                        <button type="submit" class="submit-btn">Save</button>
                        <button type="button" class="cancel-btn" id="cancel-area-form">Cancel</button>
                    </div>
                </form>
            </div>
            <div class="loader" id="areas-loader">Loading areas...</div>
            <div class="error-message" id="areas-error"></div>
            <table id="areas-table">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Manager</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody id="areas-list">
                <!-- Areas will be added here dynamically -->
                </tbody>
            </table>

        </div>

        <!-- Hunters Tab Content -->
        <div class="tab-content" id="hunters-content">
            <button class="add-btn" id="add-hunter-btn">Add New Hunter</button>
            <!-- Hunter Form -->
            <div class="form-container" id="hunter-form">
                <h2 id="hunter-form-title">Add New Hunter</h2>
                <form id="hunter-form-element">
                    <input type="hidden" id="hunter-id">
                    <div class="form-group">
                        <label for="hunter-name">Name:</label>
                        <input type="text" id="hunter-name" required>
                    </div>
                    <div class="form-group">
                        <label for="hunter-area">Assigned Area:</label>
                        <select id="hunter-area" required>
                            <option value="">Select an area</option>
                            <!-- Areas will be loaded dynamically -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="hunter-phone">Phone:</label>
                        <input type="text" id="hunter-phone">
                    </div>
                    <div class="form-group">
                        <label for="hunter-email">Email:</label>
                        <input type="text" id="hunter-email">
                    </div>
                    <div class="form-buttons">
                        <button type="submit" class="submit-btn">Save</button>
                        <button type="button" class="cancel-btn" id="cancel-hunter-form">Cancel</button>
                    </div>
                </form>
            </div>
            <div class="loader" id="hunters-loader">Loading hunters...</div>
            <div class="error-message" id="hunters-error"></div>
            <table id="hunters-table">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Assigned Area</th>
                    <th>Phone</th>
                    <th>Email</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody id="hunters-list">
                <!-- Hunters will be added here dynamically -->
                </tbody>
            </table>
        </div>

        <!-- Blinds Tab Content -->
        <div class="tab-content" id="blinds-content">
            <button class="add-btn" id="add-blind-btn">Nytt Pass</button>
            <!-- Blind Form -->
            <div class="form-container" id="blind-form">
                <h2 id="blind-form-title">Nytt Pass</h2>
                <form id="blind-form-element">
                    <input type="hidden" id="blind-id">
                    <div class="form-group">
                        <label for="blind-description">Namn/Nummer:</label>
                        <textarea id="blind-description" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="blind-type">Typ:</label>
                        <select id="blind-type" required>
                            <option value="">Select a type</option>
                            <option value="Tower">Torn</option>
                            <option value="Ground">Ryggsäck</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="blind-area">Såt:</label>
                        <select id="blind-area">
                            <option value="">Select an area</option>
                            <!-- Areas will be loaded dynamically -->
                        </select>
                    </div>
                    <div class="form-buttons">
                        <button type="submit" class="submit-btn">Spara</button>
                        <button type="button" class="cancel-btn" id="cancel-blind-form">Avbryt</button>
                    </div>
                </form>
            </div>
            <div class="loader" id="blinds-loader">Laddar pass...</div>
            <div class="error-message" id="blinds-error"></div>
            <table id="blinds-table">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Namn/Nummer</th>
                    <th>Typ</th>
                    <th>Såt</th>
                    <th>Åtgärder</th>
                    <th></th>
                </tr>
                </thead>
                <tbody id="blinds-list">
                <!-- Blinds will be added here dynamically -->
                </tbody>
            </table>
        </div>

        <!-- Reports Tab Content -->
        <div class="tab-content" id="reports-content">
            <button class="add-btn" id="add-report-btn">Add New report</button>
            <!-- Report Form -->
            <div class="form-container" id="report-form">
                <h2 id="report-form-title">Add New report</h2>
                <form id="report-form-element">
                    <input type="hidden" id="report-id">
                    <div class="form-group">
                        <label for="report-repair">Repair:</label>
                        <textarea id="report-repair"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="report-blind">Assigned Blind:</label>
                        <select id="report-blind">
                            <option value="" disabled>Select a blind</option>
                            <!-- Blinds will be loaded dynamically -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="report-move">Move:</label>
                        <select id="report-move">
                            <option value="false">No</option>
                            <option value="true">Yes</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="report-clear">Clear:</label>
                        <select id="report-clear">
                            <option value="false">No</option>
                            <option value="true">Yes</option>
                        </select>
                    </div>
                    <div class="form-buttons">
                        <button type="submit" class="submit-btn">Save</button>
                        <button type="button" class="cancel-btn" id="cancel-report-form">Cancel</button>
                    </div>
                </form>
            </div>
            <div class="loader" id="reports-loader">Loading reports...</div>
            <div class="error-message" id="reports-error"></div>
            <table id="reports-table">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Blind</th>
                    <th>Repair</th>
                    <th>Move</th>
                    <th>Clear</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody id="reports-list">
                <!-- Reports will be added here dynamically -->
                </tbody>
            </table>
        </div>

        <!-- Observations Tab Content -->
        <div class="tab-content" id="observations-content">
            <button class="add-btn" id="add-observation-btn">Add New Observation</button>
            <!-- Observation Form -->
            <div class="form-container" id="observation-form">
                <h2 id="observation-form-title">Add New Observation</h2>
                <form id="observation-form-element">
                    <input type="hidden" id="observation-id">
                    <div class="form-group">
                        <label for="observation-blind">Blind:</label>
                        <select id="observation-blind">
                            <option value="" disabled>Select a blind</option>
                            <!-- Blinds will be loaded dynamically -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="observation-animal">Animal:</label>
                        <input id="observation-animal" type="text">
                    </div>
                    <div class="form-group">
                        <label for="observation-count">Count:</label>
                        <input id="observation-count" type="number" min="0">
                    </div>
                    <div class="form-buttons">
                        <button type="submit" class="submit-btn">Save</button>
                        <button type="button" class="cancel-btn" id="cancel-observation-form">Cancel</button>
                    </div>
                </form>
            </div>
            <div class="loader" id="observations-loader">Loading observations...</div>
            <div class="error-message" id="observations-error"></div>
            <table id="observations-table">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Blind</th>
                    <th>Animal</th>
                    <th>Count</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody id="observations-list">
                <!-- Observations will be added here dynamically -->
                </tbody>
            </table>

        </div>

        <!-- Lottery Tab Content -->
        <div class="tab-content" id="lottery-content">
            <h2>Passlottning</h2>
            <div class="lottery-selector">
                <div class="lottery-list">
                    <table id="lottery-hunters-table" class="lottery-table">
                        <thead>
                            <tr>
                                <th></th>
                                <th>Jägare</th>
                            </tr>
                        </thead>
                        <tbody id="lottery-hunters-list">
                        <!-- Hunters will be added dynamically -->
                        </tbody>
                    </table>
                </div>
                <div class="lottery-list">
                    <table id="lottery-blinds-table" class="lottery-table">
                        <thead>
                            <tr>
                                <th></th>
                                <th>Pass</th>
                            </tr>
                        </thead>
                        <tbody id="lottery-blinds-list">
                        <!-- Blinds will be added dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
            <button class="edit-btn" id="roll-btn">Lotta</button>
            <table id="lottery-result-table">
                <thead>
                    <tr>
                        <th>Jägare</th>
                        <th>Pass</th>
                    </tr>
                </thead>
                <tbody id="lottery-result"></tbody>
            </table>
        </div>
    </div>
</div>

<script src="config.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const BASE_URL = CONFIG.BASE_URL;

        // Cache DOM elements
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');

        // Areas elements
        const areasList = document.getElementById('areas-list');
        const areasLoader = document.getElementById('areas-loader');
        const areasError = document.getElementById('areas-error');
        const addAreaBtn = document.getElementById('add-area-btn');
        const areaForm = document.getElementById('area-form');
        const areaFormElement = document.getElementById('area-form-element');
        const areaFormTitle = document.getElementById('area-form-title');
        const cancelAreaForm = document.getElementById('cancel-area-form');

        // Hunters elements
        const huntersList = document.getElementById('hunters-list');
        const huntersLoader = document.getElementById('hunters-loader');
        const huntersError = document.getElementById('hunters-error');
        const addHunterBtn = document.getElementById('add-hunter-btn');
        const hunterForm = document.getElementById('hunter-form');
        const hunterFormElement = document.getElementById('hunter-form-element');
        const hunterFormTitle = document.getElementById('hunter-form-title');
        const cancelHunterForm = document.getElementById('cancel-hunter-form');
        const hunterArea = document.getElementById('hunter-area');

        // Blinds elements
        const blindsList = document.getElementById('blinds-list');
        const blindsLoader = document.getElementById('blinds-loader');
        const blindsError = document.getElementById('blinds-error');
        const addBlindBtn = document.getElementById('add-blind-btn');
        const blindForm = document.getElementById('blind-form');
        const blindFormElement = document.getElementById('blind-form-element');
        const blindFormTitle = document.getElementById('blind-form-title');
        const cancelBlindForm = document.getElementById('cancel-blind-form');

        // Reports elements
        const reportsList = document.getElementById('reports-list');
        const reportsLoader = document.getElementById('reports-loader');
        const reportsError = document.getElementById('reports-error');
        const addReportBtn = document.getElementById('add-report-btn');
        const reportForm = document.getElementById('report-form');
        const reportFormElement = document.getElementById('report-form-element');
        const reportFormTitle = document.getElementById('report-form-title');
        const cancelReportForm = document.getElementById('cancel-report-form');

        // Observations elements
        const observationsList = document.getElementById('observations-list');
        const observationsLoader = document.getElementById('observations-loader');
        const observationsError = document.getElementById('observations-error');
        const addObservationBtn = document.getElementById('add-observation-btn');
        const observationForm = document.getElementById('observation-form');
        const observationFormElement = document.getElementById('observation-form-element');
        const observationFormTitle = document.getElementById('observation-form-title');
        const cancelObservationForm = document.getElementById('cancel-observation-form');

        // Store current data
        let areas = [];
        let hunters = [];
        let blinds = [];
        let reports = [];
        let observations = [];

        let currentAreaId = null;
        let currentHunterId = null;
        let currentBlindId = null;
        let currentReportId = null;
        let currentObservationId = null;

        // Tab switching
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove active class from all tabs and contents
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));

                // Add active class to clicked tab and corresponding content
                tab.classList.add('active');
                const tabName = tab.getAttribute('data-tab');
                document.getElementById(`${tabName}-content`).classList.add('active');

                // Load data for the tab if it's not already loaded
                if (tabName === 'areas' && areas.length === 0) {
                    loadAreas();
                } else if (tabName === 'hunters' && hunters.length === 0) {
                    loadHunters();
                } else if (tabName === 'blinds' && blinds.length === 0) {
                    loadBlinds();
                } else if (tabName === 'reports' && reports.length === 0) {
                    loadReports();
                } else if (tabName === 'observations' && observations.length === 0) {
                    loadObservations();
                } else if (tabName === 'lottery') {
                    // Populate hunters list
                    for (const hunter of hunters) {
                        let row = document.getElementById('lottery-hunters-list').insertRow();
                        row.insertCell().innerHTML = `<input type="checkbox" value="${hunter.id}">`;
                        row.insertCell().innerText = hunter.name;
                    }

                    // Populate blinds list
                    for (const blind of blinds) {
                        let row = document.getElementById('lottery-blinds-list').insertRow();
                        row.insertCell().innerHTML = `<input type="checkbox" value="${blind.id}">`;
                        row.insertCell().innerText = blind.description;
                    }

                    document.getElementById('roll-btn').addEventListener('click', e => {
                        const selectedHunters = document.querySelectorAll('#lottery-hunters-table tbody input[type="checkbox"]:checked');
                        const selectedBlinds = document.querySelectorAll('#lottery-blinds-table tbody input[type="checkbox"]:checked');

                        if (selectedHunters.length !==  selectedBlinds.length) {
                            alert(`Välj lika många jägare (${selectedHunters.length}) som pass (${selectedBlinds.length}).`);
                            return;
                        }

                        fetch(`${BASE_URL}/lottery`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                hunters: Array.from(selectedHunters).map(h => h.value),
                                blinds: Array.from(selectedBlinds).map(b => b.value)
                            })
                        })
                        .then(response => response.json())
                        .then(data => {
                            let table = document.getElementById('lottery-result');
                            table.innerHTML = '';
                            for (const pair of data.pairs) {
                                let row = table.insertRow();
                                row.insertCell().innerText = pair.hunter.name;
                                row.insertCell().innerText = pair.blind.description;
                            }
                        })
                    })
                }
            });
        });

        // Initial data load
        loadAreas();
        loadBlinds();
        loadHunters();

        // Areas CRUD operations
        function loadAreas() {
            showLoader(areasLoader);
            hideError(areasError);

            fetch(`${BASE_URL}/area`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to load areas');
                    }
                    return response.json();
                })
                .then(data => {
                    areas = data;
                    renderAreas();
                    hideLoader(areasLoader);
                })
                .catch(error => {
                    showError(areasError, error.message);
                    hideLoader(areasLoader);
                });
        }

        function renderAreas() {
            areasList.innerHTML = '';

            if (areas.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="5" style="text-align: center;">No areas found</td>';
                areasList.appendChild(row);
                return;
            }

            areas.forEach(area => {
                const row = document.createElement('tr');
                row.innerHTML = `
                        <td>${area.id}</td>
                        <td>${area.name}</td>
                        <td>${area.description}</td>
                        <td>${area.manager || 'N/A'}</td>
                        <td>
                            <button class="action-btn edit-btn" data-id="${area.id}">Edit</button>
                            <button class="action-btn delete-btn" data-id="${area.id}">Delete</button>
                        </td>
                    `;

                // Add event listeners
                const editBtn = row.querySelector('.edit-btn');
                const deleteBtn = row.querySelector('.delete-btn');

                editBtn.addEventListener('click', () => editArea(area.id));
                deleteBtn.addEventListener('click', () => deleteArea(area.id));

                areasList.appendChild(row);
            });

            // Also update hunter form options
            updateHunterAreaOptions();
        }

        function editArea(id) {
            const area = areas.find(a => a.id === id);
            if (!area) return;

            currentAreaId = id;
            document.getElementById('area-id').value = area.id;
            document.getElementById('area-name').value = area.name;
            document.getElementById('area-description').value = area.description;
            document.getElementById('area-manager').value = area.manager || '';

            areaFormTitle.textContent = 'Edit Area';
            showForm(areaForm);
        }

        function deleteArea(id) {
            if (!confirm('Are you sure you want to delete this area?')) {
                return;
            }

            showLoader(areasLoader);
            hideError(areasError);

            fetch(`${BASE_URL}/area/${id}`, {
                method: 'DELETE'
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to delete area');
                    }
                    // Remove area from the list
                    areas = areas.filter(a => a.id !== id);
                    // Also remove associated hunters
                    hunters = hunters.filter(h => h.areaId !== id);
                    renderAreas();
                    hideLoader(areasLoader);
                })
                .catch(error => {
                    showError(areasError, error.message);
                    hideLoader(areasLoader);
                    renderAreas();
                });
        }

        addAreaBtn.addEventListener('click', () => {
            currentAreaId = null;
            areaFormElement.reset();
            areaFormTitle.textContent = 'Add New Area';
            showForm(areaForm);
        });

        cancelAreaForm.addEventListener('click', () => {
            hideForm(areaForm);
        });

        areaFormElement.addEventListener('submit', (e) => {
            e.preventDefault();

            const areaData = {
                name: document.getElementById('area-name').value,
                description: document.getElementById('area-description').value,
                manager: document.getElementById('area-manager').value || null
            };

            showLoader(areasLoader);
            hideError(areasError);

            if (currentAreaId) {
                // Update existing area
                areaData.id = currentAreaId;

                fetch(`${BASE_URL}/area/${currentAreaId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(areaData)
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to update area');
                        }
                        return response.json();
                    })
                    .then(updatedArea => {
                        // Update area in the list
                        const index = areas.findIndex(a => a.id === currentAreaId);
                        if (index !== -1) {
                            areas[index] = updatedArea;
                        }
                        renderAreas();
                        hideForm(areaForm);
                        hideLoader(areasLoader);
                    })
                    .catch(error => {
                        showError(areasError, error.message);
                        hideLoader(areasLoader);
                        renderAreas();
                        hideForm(areaForm);
                    });
            } else {
                // Add new area
                fetch(`${BASE_URL}/area`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(areaData)
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to add area');
                        }
                        return response.json();
                    })
                    .then(newArea => {
                        areas.push(newArea);
                        renderAreas();
                        hideForm(areaForm);
                        hideLoader(areasLoader);
                    })
                    .catch(error => {
                        showError(areasError, error.message);
                        hideLoader(areasLoader);
                        areas.push(areaData);
                        renderAreas();
                        hideForm(areaForm);
                    });
            }
        });

        // Hunters CRUD operations
        function loadHunters() {
            showLoader(huntersLoader);
            hideError(huntersError);
            fetch(`${BASE_URL}/hunters`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to load hunters');
                    }
                    return response.json();
                })
                .then(data => {
                    hunters = data;
                    renderHunters();
                    hideLoader(huntersLoader);
                })
                .catch(error => {
                    showError(huntersError, error.message);
                    hideLoader(huntersLoader);
                });
        }

        function updateHunterAreaOptions() {
            hunterArea.innerHTML = '<option value="">Select an area</option>';

            areas.forEach(area => {
                const option = document.createElement('option');
                option.value = area.id;
                option.textContent = area.name;
                hunterArea.appendChild(option);
            });
        }

        function renderHunters() {
            huntersList.innerHTML = '';

            if (hunters.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="4" style="text-align: center;">No hunters found</td>';
                huntersList.appendChild(row);
                return;
            }

            hunters.forEach(hunter => {
                const area = areas.find(a => a.id === hunter.areaId);
                const areaName = area ? area.name : 'Unknown Area';

                const row = document.createElement('tr');
                row.innerHTML = `
                        <td>${hunter.id}</td>
                        <td>${hunter.name}</td>
                        <td>${areaName}</td>
                        <td>${hunter.phone || ''}</td>
                        <td>${hunter.email || ''}</td>
                        <td>
                            <button class="action-btn edit-btn" data-id="${hunter.id}">Edit</button>
                            <button class="action-btn delete-btn" data-id="${hunter.id}">Delete</button>
                        </td>
                    `;

                // Add event listeners
                const editBtn = row.querySelector('.edit-btn');
                const deleteBtn = row.querySelector('.delete-btn');

                editBtn.addEventListener('click', () => editHunter(hunter.id));
                deleteBtn.addEventListener('click', () => deleteHunter(hunter.id));

                huntersList.appendChild(row);
            });
        }

        function editHunter(id) {
            const hunter = hunters.find(h => h.id === id);
            if (!hunter) return;

            currentHunterId = id;
            document.getElementById('hunter-id').value = hunter.id;
            document.getElementById('hunter-name').value = hunter.name;
            document.getElementById('hunter-area').value = hunter.areaId;
            document.getElementById('hunter-phone').value = hunter.phone;
            document.getElementById('hunter-email').value = hunter.email;

            hunterFormTitle.textContent = 'Edit Hunter';
            showForm(hunterForm);
        }

        function deleteHunter(id) {
            if (!confirm('Are you sure you want to delete this hunter?')) {
                return;
            }

            showLoader(huntersLoader);
            hideError(huntersError);

            fetch(`${BASE_URL}/hunter/${id}`, {
                method: 'DELETE'
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to delete hunter');
                    }
                    // Remove hunter from the list
                    hunters = hunters.filter(h => h.id !== id);
                    renderHunters();
                    hideLoader(huntersLoader);
                })
                .catch(error => {
                    showError(huntersError, error.message);
                    hideLoader(huntersLoader);
                    renderHunters();
                });
        }

        addHunterBtn.addEventListener('click', () => {
            currentHunterId = null;
            hunterFormElement.reset();
            hunterFormTitle.textContent = 'Add New Hunter';
            showForm(hunterForm);
        });

        cancelHunterForm.addEventListener('click', () => {
            hideForm(hunterForm);
        });

        hunterFormElement.addEventListener('submit', (e) => {
            e.preventDefault();

            const hunterData = {
                name: document.getElementById('hunter-name').value,
                areaId: document.getElementById('hunter-area').value,
                phone: document.getElementById('hunter-phone').value,
                email: document.getElementById('hunter-email').value
            };

            showLoader(huntersLoader);
            hideError(huntersError);

            if (currentHunterId) {
                // Update existing hunter
                hunterData.id = currentHunterId;

                fetch(`${BASE_URL}/hunter/${currentHunterId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(hunterData)
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to update hunter');
                        }
                        return response.json();
                    })
                    .then(updatedHunter => {
                        // Update hunter in the list
                        const index = hunters.findIndex(h => h.id === currentHunterId);
                        if (index !== -1) {
                            hunters[index] = updatedHunter;
                        }
                        renderHunters();
                        hideForm(hunterForm);
                        hideLoader(huntersLoader);
                    })
                    .catch(error => {
                        showError(huntersError, error.message);
                        hideLoader(huntersLoader);
                        renderHunters();
                        hideForm(hunterForm);
                    });
            } else {
                // Add new hunter
                fetch(`${BASE_URL}/hunter`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(hunterData)
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to add hunter');
                        }
                        return response.json();
                    })
                    .then(newHunter => {
                        hunters.push(newHunter);
                        renderHunters();
                        hideForm(hunterForm);
                        hideLoader(huntersLoader);
                    })
                    .catch(error => {
                        showError(huntersError, error.message);
                        hideLoader(huntersLoader);
                        renderHunters();
                        hideForm(hunterForm);
                    });
            }
        });

        // Blinds CRUD operations
        function loadBlinds() {
            showLoader(blindsLoader);
            hideError(blindsError);

            fetch(`${BASE_URL}/blinds`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to load blinds');
                    }
                    return response.json();
                })
                .then(data => {
                    blinds = data;
                    renderBlinds();
                    hideLoader(blindsLoader);
                })
                .catch(error => {
                    showError(blindsError, error.message);
                    hideLoader(blindsLoader);
                });
        }

        function renderBlinds() {
            blindsList.innerHTML = '';


            if (blinds.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="5" style="text-align: center;">No blinds found</td>';
                blindsList.appendChild(row);
                return;
            }

            blinds.forEach(blind => {
                const row = document.createElement('tr');
                const area = areas.find(a => a.id === blind.areaId);
                const areaName = area ? area.name : 'Unknown Area';
                row.innerHTML = `
                        <td>${blind.id}</td>
                        <td>${blind.description}</td>
                        <td>${blind.type || 'N/A'}</td>
                        <td>${areaName}</td>
                        <td>
                            <button class="action-btn edit-btn" data-id="${blind.id}">Edit</button>
                            <button class="action-btn delete-btn" data-id="${blind.id}">Delete</button>
                        </td>
                    `;

                // Add event listeners
                const editBtn = row.querySelector('.edit-btn');
                const deleteBtn = row.querySelector('.delete-btn');

                editBtn.addEventListener('click', () => editBlind(blind.id));
                deleteBtn.addEventListener('click', () => deleteBlind(blind.id));

                blindsList.appendChild(row);
            });

            updateBlindAreaOptions();
        }

        addBlindBtn.addEventListener('click', () => {
            currentBlindId = null;
            blindFormElement.reset();
            blindFormTitle.textContent = 'Add New Blind';
            showForm(blindForm);
        });

        cancelBlindForm.addEventListener('click', () => {
            hideForm(blindForm);
        });

        blindFormElement.addEventListener('submit', (e) => {
            e.preventDefault();
            const blindData = {
                description: document.getElementById('blind-description').value,
                type: document.getElementById('blind-type').value,
                areaId: document.getElementById('blind-area').value
            };
            showLoader(blindsLoader);
            hideError(blindsError);

            if (currentBlindId) {
                // Update existing blind
                blindData.id = currentBlindId;
                fetch(`${BASE_URL}/blind/${currentBlindId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(blindData)
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to update blind');
                        }
                        return response.json();
                    })
                    .then(updatedBlind => {
                        // Update blind in the list
                        const index = blinds.findIndex(b => b.id === currentBlindId);
                        if (index !== -1) {
                            blinds[index] = updatedBlind;
                        }
                        renderBlinds();
                        hideForm(blindForm);
                        hideLoader(blindsLoader);
                    })
                    .catch(error => {
                        showError(blindsError, error.message);
                        hideLoader(blindsLoader);
                        renderBlinds();
                        hideForm(blindForm);
                    });
            } else {
                // Add new blind
                fetch(`${BASE_URL}/blind`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(blindData)
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to add blind');
                        }
                        return response.json();
                    })
                    .then(newBlind => {
                        blinds.push(newBlind);
                        renderBlinds();
                        hideForm(blindForm);
                        hideLoader(blindsLoader);
                    })
                    .catch(error => {
                        showError(blindsError, error.message);
                        hideLoader(blindsLoader);
                        renderBlinds();
                        hideForm(blindForm);
                    });
            }
        });

        function editBlind(id) {
            const blind = blinds.find(b => b.id === id);
            if (!blind) return;

            currentBlindId = id;
            document.getElementById('blind-id').value = blind.id;
            document.getElementById('blind-description').value = blind.description;
            document.getElementById('blind-type').value = blind.type || '';
            document.getElementById('blind-area').value = blind.areaId || '';

            blindFormTitle.textContent = 'Edit Blind';
            showForm(blindForm);
        }

        function deleteBlind(id) {
            if (!confirm('Are you sure you want to delete this blind?')) {
                return;
            }

            showLoader(blindsLoader);
            hideError(blindsError);

            fetch(`${BASE_URL}/blind/${id}`, {
                method: 'DELETE'
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to delete blind');
                    }
                    // Remove blind from the list
                    blinds = blinds.filter(b => b.id !== id);
                    renderBlinds();
                    hideLoader(blindsLoader);
                })
                .catch(error => {
                    showError(blindsError, error.message);
                    hideLoader(blindsLoader);
                    renderBlinds();
                });
        }

        function updateBlindAreaOptions() {
            const blindArea = document.getElementById('blind-area');
            blindArea.innerHTML = '<option value="">Select an area</option>';

            areas.forEach(area => {
                const option = document.createElement('option');
                option.value = area.id;
                option.textContent = area.name;
                blindArea.appendChild(option);
            });
        }

        // Reports CRUD operations
        function loadReports() {
            showLoader(reportsLoader);
            hideError(reportsError);

            fetch(`${BASE_URL}/reports`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to load reports');
                    }
                    return response.json();
                })
                .then(data => {
                    reports = data;
                    renderReports();
                    hideLoader(reportsLoader);
                })
                .catch(error => {
                    showError(reportsError, error.message);
                    hideLoader(reportsLoader);
                });
        }

        addReportBtn.addEventListener('click', (e) => {
            e.preventDefault();
            currentReportId = null;
            reportFormElement.reset();
            reportFormTitle.textContent = 'Add New Report';
            showForm(reportForm);
        });

        cancelReportForm.addEventListener('click', () => {
            hideForm(reportForm);
        });

        reportFormElement.addEventListener('submit', (e) => {
            e.preventDefault();
            const reportData = {
                repair: document.getElementById('report-repair').value,
                blindId: document.getElementById('report-blind').value,
                move: document.getElementById('report-move').value === 'true',
                clear: document.getElementById('report-clear').value === 'true'
            };
            showLoader(reportsLoader);
            hideError(reportsError);

            if (currentReportId) {
                // Update existing report
                reportData.id = currentReportId;
                fetch(`${BASE_URL}/report/${currentReportId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(reportData)
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to update report');
                        }
                        return response.json();
                    })
                    .then(updatedReport => {
                        // Update report in the list
                        const index = reports.findIndex(r => r.id === currentReportId);
                        if (index !== -1) {
                            reports[index] = updatedReport;
                        }
                        renderReports();
                        hideForm(reportForm);
                        hideLoader(reportsLoader);
                    })
                    .catch(error => {
                        showError(reportsError, error.message);
                        hideLoader(reportsLoader);
                        renderReports();
                        hideForm(reportForm);
                    });
            } else {
                // Add new report
                fetch(`${BASE_URL}/report`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(reportData)
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to add report');
                        }
                        return response.json();
                    })
                    .then(newReport => {
                        reports.push(newReport);
                        renderReports();
                        hideForm(reportForm);
                        hideLoader(reportsLoader);
                    })
                    .catch(error => {
                        showError(reportsError, error.message);
                        hideLoader(reportsLoader);
                        renderReports();
                        hideForm(reportForm);
                    });
            }
        });

        function renderReports() {
            reportsList.innerHTML = '';

            if (reports.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="3" style="text-align: center;">No reports found</td>';
                reportsList.appendChild(row);
                return;
            }

            reports.forEach(report => {
                const row = document.createElement('tr');
                const blind = blinds.find(b => b.id === report.blindId);
                const blindDescription = blind ? blind.description : 'Unknown Blind';
                row.innerHTML = `
                        <td>${report.id}</td>
                        <td>${blindDescription}</td>
                        <td>${report.repair}</td>
                        <td>${report.move ? 'Yes' : 'No'}</td>
                        <td>${report.clear ? 'Yes' : 'No'}</td>
                        <td>
                            <button class="action-btn edit-btn" data-id="${report.id}">Edit</button>
                            <button class="action-btn delete-btn" data-id="${report.id}">Delete</button>
                        </td>
                    `;

                // Add event listeners
                const editBtn = row.querySelector('.edit-btn');
                const deleteBtn = row.querySelector('.delete-btn');

                editBtn.addEventListener('click', () => editReport(report.id));
                deleteBtn.addEventListener('click', () => deleteReport(report.id));

                reportsList.appendChild(row);
            });

            updateReportBlindOptions();
        }

        function editReport(id) {
            const report = reports.find(r => r.id === id);
            if (!report) return;

            currentReportId = id;
            document.getElementById('report-id').value = report.id;
            document.getElementById('report-repair').value = report.repair;
            document.getElementById('report-move').value = report.move || 'false';
            document.getElementById('report-clear').value = report.clear || 'false';
            document.getElementById('report-blind').value = report.blindId || 'N/A';

            reportFormTitle.textContent = 'Edit Report';
            showForm(reportForm);
        }

        function deleteReport(id) {
            if (!confirm('Are you sure you want to delete this report?')) {
                return;
            }

            showLoader(reportsLoader);
            hideError(reportsError);

            fetch(`${BASE_URL}/report/${id}`, {
                method: 'DELETE'
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to delete report');
                    }
                    // Remove report from the list
                    reports = reports.filter(r => r.id !== id);
                    renderReports();
                    hideLoader(reportsLoader);
                })
                .catch(error => {
                    showError(reportsError, error.message);
                    hideLoader(reportsLoader);
                    renderReports();
                });
        }

        function updateReportBlindOptions() {
            const reportBlind = document.getElementById('report-blind');
            reportBlind.innerHTML = '<option value="" disabled>Select a blind</option>';

            blinds.forEach(blind => {
                const option = document.createElement('option');
                option.value = blind.id;
                option.textContent = blind.description;
                reportBlind.appendChild(option);
            });
        }

        // Observations CRUD operations
        function loadObservations() {
            showLoader(observationsLoader);
            hideError(observationsError);

            fetch(`${BASE_URL}/observations`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to load observations');
                    }
                    return response.json();
                })
                .then(data => {
                    observations = data;
                    renderObservations();
                    hideLoader(observationsLoader);
                })
                .catch(error => {
                    showError(observationsError, error.message);
                    hideLoader(observationsLoader);
                });
        }

        addObservationBtn.addEventListener('click', (e) => {
            e.preventDefault();
            currentObservationId = null;
            observationFormElement.reset();
            observationFormTitle.textContent = 'Add New Observation';
            showForm(observationForm);
        });

        cancelObservationForm.addEventListener('click', () => {
            hideForm(observationForm);
        });

        observationFormElement.addEventListener('submit', (e) => {
            e.preventDefault();
            const observationData = {
                blindId: document.getElementById('observation-blind').value,
                animal: document.getElementById('observation-animal').value,
                count: document.getElementById('observation-count').value,
            };
            showLoader(observationsLoader);
            hideError(observationsError);

            if (currentObservationId) {
                // Update existing observation
                observationData.id = currentObservationId;
                fetch(`${BASE_URL}/observation/${currentObservationId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(observationData)
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to update observation');
                        }
                        return response.json();
                    })
                    .then(updatedObservation => {
                        // Update observation in the list
                        const index = observations.findIndex(o => o.id === currentObservationId);
                        if (index !== -1) {
                            observations[index] = updatedObservation;
                        }
                        renderObservations();
                        hideForm(observationForm);
                        hideLoader(observationsLoader);
                    })
                    .catch(error => {
                        showError(observationsError, error.message);
                        hideLoader(observationsLoader);
                        renderObservations();
                        hideForm(observationForm);
                    });
            } else {
                // Add new observation
                fetch(`${BASE_URL}/observation`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(observationData)
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to add observation');
                        }
                        return response.json();
                    })
                    .then(newObservation => {
                        observations.push(newObservation);
                        renderObservations();
                        hideForm(observationForm);
                        hideLoader(observationsLoader);
                    })
                    .catch(error => {
                        showError(observationsError, error.message);
                        hideLoader(observationsLoader);
                        renderObservations();
                        hideForm(observationForm);
                    });
            }
        });

        function renderObservations() {
            observationsList.innerHTML = '';

            if (observations.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="3" style="text-align: center;">No observations found</td>';
                observationsList.appendChild(row);
                return;
            }

            observations.forEach(observation => {
                const row = document.createElement('tr');
                const blind = blinds.find(b => b.id === observation.blindId);
                const blindDescription = blind ? blind.description : 'Unknown Blind';
                row.innerHTML = `
                        <td>${observation.id}</td>
                        <td>${blindDescription}</td>
                        <td>${observation.animal || 'N/A'}</td>
                        <td>${observation.count || 0}</td>
                        <td>
                            <button class="action-btn delete-btn" data-id="${observation.id}">Delete</button>
                        </td>
                    `;

                // Add event listeners
                const deleteBtn = row.querySelector('.delete-btn');

                deleteBtn.addEventListener('click', () => deleteObservation(observation.id));

                observationsList.appendChild(row);
            });

            const observationBlind = document.getElementById('observation-blind');
            populateBlindsSelect(observationBlind);
        }

        function deleteObservation(id) {
            if (!confirm('Are you sure you want to delete this observation?')) {
                return;
            }

            showLoader(observationsLoader);
            hideError(observationsError);

            fetch(`${BASE_URL}/observation/${id}`, {
                method: 'DELETE'
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to delete observation');
                    }
                    // Remove observation from the list
                    observations = observations.filter(o => o.id !== id);
                    renderObservations();
                    hideLoader(observationsLoader);
                })
                .catch(error => {
                    showError(observationsError, error.message);
                    hideLoader(observationsLoader);
                    renderObservations();
                });
        }

        function populateBlindsSelect(selectElement) {
            selectElement.innerHTML = '<option value="" disabled>Select a blind</option>';

            blinds.forEach(blind => {
                const option = document.createElement('option');
                option.value = blind.id;
                option.textContent = blind.description;
                selectElement.appendChild(option);
            });
        }



        function showLoader(loader) {
            loader.style.display = 'block';
        }

        function hideError(error) {
            error.style.display = 'none';
        }

        function showError(error, message) {
            error.textContent = message;
            error.style.display = 'block';
        }

        function hideLoader(loader) {
            loader.style.display = 'none';
        }

        function showForm(form) {
            form.style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function hideForm(form) {
            form.style.display = 'none';
        }
    });
</script>
</body>
</html>
